<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ø¯ÙˆØ±ÙŠ EA FC 26 Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ</title>
  <style>
    :root {
      --bg: #020617;
      --bg-surface: #020818;
      --border-subtle: #1f2933;
      --accent: #eab308;
      --accent-soft: rgba(234, 179, 8, 0.1);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;
      --radius-lg: 14px;
      --radius-md: 10px;
      --radius-pill: 999px;
    }

    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: var(--text-main);
      margin: 0;
      min-height: 100vh;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 30;
      backdrop-filter: blur(12px);
      background: rgba(15,23,42,0.96);
      border-bottom: 1px solid rgba(31,41,55,0.9);
    }

    .header-inner {
      max-width: 960px;
      margin: 0 auto;
      padding: 10px 14px 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .hero-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      min-width: 0;
    }

    .hero-main {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .hero-logo {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      background: #0b1120;
      border: 1px solid #1f2937;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: var(--accent);
    }

    .hero-text h1 {
      margin: 0;
      font-size: 18px;
      letter-spacing: 0.02em;
      color: var(--accent);
    }

    .hero-text p {
      margin: 2px 0 0;
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .hero-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .mode-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: var(--radius-pill);
      border: 1px solid #1f2937;
      background: #020818;
      color: var(--text-muted);
    }

    .mode-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    .nav-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 4px;
    }

    .nav-pill {
      flex: 0 0 auto;
      border-radius: var(--radius-pill);
      border: 1px solid #1f2937;
      background: #020818;
      color: var(--text-muted);
      font-size: 11px;
      padding: 5px 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .nav-pill span.icon { font-size: 13px; }

    .nav-pill.active {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--accent);
    }

    .nav-pill.disabled {
      opacity: 0.6;
      cursor: default;
    }

    @media (max-width: 640px) {
      .hero-row { flex-direction: column; align-items: flex-start; }
      .hero-text p { white-space: normal; }
      .hero-meta { align-items: flex-start; }
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 14px 28px;
    }

    .panel {
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      padding: 12px 12px 14px;
      margin-bottom: 12px;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .panel-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 600;
    }

    .panel-title-pill {
      width: 3px;
      height: 16px;
      border-radius: 999px;
      background: var(--accent);
    }

    .panel-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    .page-section { display: none; }
    .page-section.active { display: block; }

    label {
      display: block;
      font-size: 12px;
      margin-top: 8px;
      margin-bottom: 3px;
      color: var(--text-main);
    }

    .field-hint {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 3px;
    }

    input, select, textarea {
      width: 100%;
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid #1f2933;
      background: #020617;
      color: var(--text-main);
      font-size: 13px;
      outline: none;
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--accent);
      background: #020818;
    }

    textarea { min-height: 70px; resize: vertical; }

    .field-row { display: flex; gap: 8px; }
    .field-row > div { flex: 1; }

    @media (max-width: 640px) { .field-row { flex-direction: column; } }

    button {
      border-radius: var(--radius-pill);
      border: none;
      padding: 7px 13px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent);
      color: #111827;
      margin-top: 6px;
    }

    button.btn-secondary {
      background: #020818;
      color: var(--text-main);
      border: 1px solid #1f2937;
    }

    button.btn-danger {
      background: #b91c1c;
      color: #fef2f2;
    }

    .status-text {
      font-size: 11px;
      color: var(--accent);
      margin-right: 6px;
    }

    .player-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: var(--radius-pill);
      border: 1px solid #1f2937;
      background: #020818;
      font-size: 12px;
      margin: 2px;
      max-width: 100%;
    }

    .player-pill-main { font-weight: 500; white-space: nowrap; }

    .player-pill-note {
      font-size: 11px;
      color: var(--text-soft);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 140px;
    }

    .player-pill button {
      margin-top: 0;
      padding: 2px 7px;
      font-size: 11px;
    }

    .small-text { font-size: 11px; color: var(--text-soft); margin-top: 4px; }

    .list-dot { list-style: none; padding: 0; margin: 4px 0 0; }

    .list-dot li {
      position: relative;
      padding-right: 12px;
      margin-bottom: 3px;
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .list-dot li::before {
      content: "";
      position: absolute;
      right: 2px;
      top: 7px;
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: var(--accent);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 12px;
      border-radius: var(--radius-md);
      overflow: hidden;
      background: #020617;
    }

    th, td {
      border: 1px solid #111827;
      padding: 6px 4px;
      text-align: center;
      white-space: nowrap;
    }

    th {
      background: #020818;
      color: var(--text-muted);
      font-weight: 500;
      font-size: 11px;
    }

    td {
      background: #020617;
      font-size: 11px;
    }

    tbody tr:nth-child(even) td {
      background: #030712;
    }

    td[contenteditable="true"] { cursor: text; }

    td[contenteditable="true"]:focus {
      outline: 1px solid var(--accent);
      background: #020818;
    }

    .table-caption { font-size: 11px; color: var(--text-soft); margin-top: 4px; }

    @media (max-width: 640px) {
      table { display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; }
    }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="hero-row">
      <div class="hero-main">
        <div class="hero-logo">âš½</div>
        <div class="hero-text">
          <h1 id="title-display">Ø¯ÙˆØ±ÙŠ EA FC 26 Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ</h1>
          <p>Ù„ÙˆØ­Ø© Ù…Ø¨Ø³Ø·Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡: Ø¹Ø±Ø¶ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯ØŒ ÙˆÙ„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø¯ÙŠØ±</p>
        </div>
      </div>
      <div class="hero-meta">
        <div class="mode-chip" id="modeChip">
          <span class="mode-dot"></span>
          <span id="modeText">ÙˆØ¶Ø¹: Ù…Ø´Ø§Ù‡Ø¯</span>
        </div>
        <button id="adminToggle" class="btn-secondary" style="padding:4px 10px;margin-top:6px;font-size:11px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
      </div>
    </div>
    <nav class="nav-row">
      <button class="nav-pill active" data-page="league">
        <span class="icon">ğŸ“Š</span>
        <span>Ø§Ù„Ø¯ÙˆØ±ÙŠ (Ø¹Ø±Ø¶ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯)</span>
      </button>
      <button class="nav-pill" data-page="admin" id="adminTab">
        <span class="icon">âš™ï¸</span>
        <span>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù„Ù„Ù…Ù†Ø¸Ù‘Ù…)</span>
      </button>
    </nav>
  </div>
</header>

<div class="page">
  <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ -->
  <div class="page-section active" id="page-league">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span class="panel-title-pill"></span>
          <span>ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯ÙˆØ±ÙŠ</span>
        </div>
        <span class="panel-subtitle">Ù…ÙØ­ØªØ³Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠØ±</span>
      </div>
      <table id="standingsTable">
        <thead>
          <tr>
            <th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th>
            <th>Ù„Ø¹Ø¨</th>
            <th>ÙØ§Ø²</th>
            <th>ØªØ¹Ø§Ø¯Ù„</th>
            <th>Ø®Ø³Ø±</th>
            <th>Ù„Ù‡</th>
            <th>Ø¹Ù„ÙŠÙ‡</th>
            <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
          </tr>
        </thead>
        <tbody id="standingsBody"></tbody>
      </table>
      <div class="small-text">ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ØªÙŠØ¨ Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙ‚Ø·.</div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span class="panel-title-pill"></span>
          <span>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬</span>
        </div>
      </div>
      <table id="viewerMatchesTable">
        <thead>
          <tr>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„ÙˆÙ‚Øª</th>
            <th>Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</th>
            <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
          </tr>
        </thead>
        <tbody id="viewerMatchesBody"></tbody>
      </table>
      <div class="table-caption">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ ÙŠØªÙ… Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.</div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span class="panel-title-pill"></span>
          <span>Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø¯ÙˆØ±ÙŠ</span>
        </div>
      </div>
      <ul class="list-dot" id="rulesDisplay"></ul>
    </div>
  </div>

  <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¯ÙŠØ± -->
  <div class="page-section" id="page-admin">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span class="panel-title-pill"></span>
          <span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©</span>
        </div>
        <span class="panel-subtitle">Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ù†Ø¸Ù‘Ù… ÙÙ‚Ø·</span>
      </div>

      <label>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±ÙŠ</label>
      <input id="tournamentName" type="text" value="Ø¯ÙˆØ±ÙŠ EA FC 26 Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ">
      <div class="field-hint">Ù…Ø«Ø§Ù„: Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ 1447Ù‡Ù€</div>

      <label>Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©</label>
      <select id="format">
        <option value="league">Ø¯ÙˆØ±ÙŠ (Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙŠÙ„Ø¹Ø¨ Ø¶Ø¯ Ø§Ù„Ø¬Ù…ÙŠØ¹)</option>
        <option value="knockout">ÙƒØ£Ø³ â€“ Ø¥Ù‚ØµØ§Ø¦ÙŠ Ù…Ø¨Ø§Ø´Ø±</option>
        <option value="groups-knockout">Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø«Ù… ÙƒØ£Ø³</option>
      </select>

      <label>Ù…Ø¯Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <input id="duration" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø·ÙˆØ§Ù„ Ø´Ù‡Ø± Ø±Ù…Ø¶Ø§Ù† Ø£Ùˆ Ù…Ù† 10 Ø¥Ù„Ù‰ 20 Ø±Ù…Ø¶Ø§Ù†">
    </div>

    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span class="panel-title-pill"></span>
          <span>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†</span>
        </div>
        <span class="panel-subtitle">Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ø¯ÙˆØ±ÙŠ</span>
      </div>

      <label>Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ / Ø§Ù„ÙƒÙ†ÙŠØ©</label>
      <input id="playerName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¨Ùˆ ÙÙ„Ø§Ù† Ø£Ùˆ PSN ID">

      <label>Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <input id="playerNote" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…ÙØ¶Ù„ Ø£Ùˆ Ø£ÙŠ ØªØ¹Ù„ÙŠÙ‚ Ø¨Ø³ÙŠØ·">

      <button id="addPlayer">Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨</button>
      <div class="small-text">ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª.</div>

      <div id="playersList" style="margin-top:8px;"></div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span class="panel-title-pill"></span>
          <span>Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø¯ÙˆØ±ÙŠ</span>
        </div>
        <span class="panel-subtitle">Ø§ÙƒØªØ¨ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŒ Ø¨Ù…Ø§ ÙÙŠÙ‡Ø§ Ù…Ø¯Ø© Ø§Ù„Ø´ÙˆØ· ÙˆÙ…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©</span>
      </div>
      <label>Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† (Ø³Ø·Ø± Ù„ÙƒÙ„ Ù‚Ø§Ø¹Ø¯Ø©)</label>
      <textarea id="specialRules" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¯Ø© Ø§Ù„Ø´ÙˆØ· 6 Ø¯Ù‚Ø§Ø¦Ù‚&#10;Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ù…Ø­ØªØ±Ù&#10;Ù…Ø«Ø§Ù„: Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙƒØ±Ø§Ø± Ù†ÙØ³ Ø§Ù„ÙØ±ÙŠÙ‚ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¬ÙˆÙ„Ø©"></textarea>
    </div>

    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span class="panel-title-pill"></span>
          <span>Ø¥Ø¯Ø§Ø±Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</span>
        </div>
        <span class="panel-subtitle">Ù‚Ù… Ø¨ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹ØŒ Ø«Ù… Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</span>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:6px;align-items:center;margin-bottom:6px;">
        <button id="generateSchedule" class="btn-secondary">ØªÙˆÙ„ÙŠØ¯ Ø¬Ø¯ÙˆÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©</button>
        <button id="addEmptyMatch" class="btn-secondary">Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø±Ø§Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§</button>
      </div>
      <table id="adminMatchesTable">
        <thead>
          <tr>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„ÙˆÙ‚Øª</th>
            <th>Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</th>
            <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
          </tr>
        </thead>
        <tbody id="adminMatchesBody"></tbody>
      </table>
      <div class="table-caption">Ù„Ù† ÙŠØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ ØªØ£ÙƒÙŠØ¯Ùƒ. Ø§ÙƒØªØ¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨ØµÙŠØºØ© 1-3 Ø£Ùˆ 0-0.</div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span class="panel-title-pill"></span>
          <span>Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø¸Ù‘Ù…</span>
        </div>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:6px;align-items:center;">
        <button id="saveSettings">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        <button id="recalculateStandings" class="btn-secondary">ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ØªÙŠØ¨ Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
        <button id="adminLogout" class="btn-secondary">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
      </div>
      <span class="status-text" id="saveStatus"></span>
      <div class="small-text">ÙƒÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­.</div>
    </div>
  </div>
</div>

<script>
  const STORAGE_KEY = 'ea_fc_26_tournament';
  const ADMIN_STATE_KEY = 'ea_fc_26_is_admin';
  const ADMIN_PASSWORD = 'Qq112233';

  const state = {
    tournamentName: 'Ø¯ÙˆØ±ÙŠ EA FC 26 Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ',
    format: 'league',
    duration: '',
    specialRules: [],
    players: []
  };

  let isAdmin = false;

  function loadState() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) Object.assign(state, JSON.parse(saved));
      const adminSaved = localStorage.getItem(ADMIN_STATE_KEY);
      isAdmin = adminSaved === 'true';
    } catch (e) {
      console.warn('Failed to load state', e);
    }
  }

  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function $(id) { return document.getElementById(id); }

  function formatFormat(format) {
    switch (format) {
      case 'league': return 'Ø¯ÙˆØ±ÙŠ (Ø§Ù„Ø¬Ù…ÙŠØ¹ Ø¶Ø¯ Ø§Ù„Ø¬Ù…ÙŠØ¹)';
      case 'knockout': return 'ÙƒØ£Ø³ â€“ Ø¥Ù‚ØµØ§Ø¦ÙŠ Ù…Ø¨Ø§Ø´Ø±';
      case 'groups-knockout': return 'Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø«Ù… ÙƒØ£Ø³';
      default: return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    }
  }

  function renderMode() {
    const modeText = $('modeText');
    const adminTab = $('adminTab');
    const adminToggle = $('adminToggle');
    if (isAdmin) {
      modeText.textContent = 'ÙˆØ¶Ø¹: Ù…Ø¯ÙŠØ±';
      adminToggle.textContent = 'Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± Ù…ÙØ¹Ù„';
      adminTab.classList.remove('disabled');
    } else {
      modeText.textContent = 'ÙˆØ¶Ø¹: Ù…Ø´Ø§Ù‡Ø¯';
      adminToggle.textContent = 'Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±';
      adminTab.classList.add('disabled');
    }
  }

  function syncViewerMatches() {
    const adminBody = $('adminMatchesBody');
    const viewerBody = $('viewerMatchesBody');
    viewerBody.innerHTML = '';
    adminBody.querySelectorAll('tr').forEach(row => {
      const cells = row.querySelectorAll('td');
      if (cells.length < 4) return;
      const tr = document.createElement('tr');
      for (let i = 0; i < 4; i++) {
        const td = document.createElement('td');
        td.textContent = cells[i].textContent;
        tr.appendChild(td);
      }
      viewerBody.appendChild(tr);
    });
  }

  function renderLeagueView() {
    const rulesDisplay = $('rulesDisplay');
    rulesDisplay.innerHTML = '';
    const baseRules = [`Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©: ${formatFormat(state.format)}`];
    baseRules.concat(state.specialRules.filter(r => r.trim().length > 0))
      .forEach(rule => {
        const li = document.createElement('li');
        li.textContent = rule;
        rulesDisplay.appendChild(li);
      });

    syncViewerMatches();

    const body = $('standingsBody');
    if (body.childElementCount === 0) {
      state.players.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.name}</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
        `;
        body.appendChild(tr);
      });
    }
  }

  function renderAdminView() {
    $('tournamentName').value = state.tournamentName;
    $('format').value = state.format;
    $('duration').value = state.duration;
    $('specialRules').value = state.specialRules.join('\n');

    const playersList = $('playersList');
    playersList.innerHTML = '';
    state.players.forEach((p, index) => {
      const div = document.createElement('div');
      div.className = 'player-pill';
      div.innerHTML = `
        <span class="player-pill-main">${p.name}</span>
        <span class="player-pill-note">${p.note || ''}</span>
      `;
      const btn = document.createElement('button');
      btn.className = 'btn-danger';
      btn.textContent = 'Ø­Ø°Ù';
      btn.onclick = () => {
        state.players.splice(index, 1);
        saveState();
        renderAll();
      };
      div.appendChild(btn);
      playersList.appendChild(div);
    });
  }

  function renderAll() {
    $('title-display').textContent = state.tournamentName || 'Ø¯ÙˆØ±ÙŠ EA FC 26 Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ';
    renderMode();
    renderAdminView();
    renderLeagueView();
  }

  function addEmptyMatchRow() {
    const tbody = $('adminMatchesBody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td contenteditable="true">-</td>
      <td contenteditable="true">-</td>
      <td contenteditable="true">Ù„Ø§Ø¹Ø¨ A vs Ù„Ø§Ø¹Ø¨ B</td>
      <td contenteditable="true">-</td>
    `;
    tbody.appendChild(tr);
    syncViewerMatches();
  }

  function generateLeagueSchedule(tbody, players) {
    players.forEach((home, i) => {
      for (let j = i + 1; j < players.length; j++) {
        const away = players[j];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td contenteditable="true">-</td>
          <td contenteditable="true">-</td>
          <td contenteditable="true">${home} vs ${away}</td>
          <td contenteditable="true">-</td>
        `;
        tbody.appendChild(tr);
      }
    });
  }

  function generateKnockoutSchedule(tbody, players) {
    for (let i = 0; i < players.length; i += 2) {
      const p1 = players[i];
      const p2 = players[i + 1];
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td contenteditable="true">-</td>
        <td contenteditable="true">-</td>
        <td contenteditable="true">${p1}${p2 ? ' vs ' + p2 : ' (ÙŠØªØ£Ù‡Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)'} </td>
        <td contenteditable="true">-</td>
      `;
      tbody.appendChild(tr);
    }
  }

  function generateSchedule() {
    const tbody = $('adminMatchesBody');
    const players = state.players.map(p => p.name).filter(Boolean);
    if (players.length < 2) {
      alert('ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„ØªÙˆÙ„ÙŠØ¯ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª.');
      return;
    }
    if (tbody.childElementCount > 0) {
      const confirmClear = confirm('Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø¬Ø¯ÙŠØ¯. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ');
      if (!confirmClear) return;
      tbody.innerHTML = '';
    }
    if (state.format === 'league') {
      generateLeagueSchedule(tbody, players);
    } else if (state.format === 'knockout') {
      generateKnockoutSchedule(tbody, players);
    } else {
      generateLeagueSchedule(tbody, players);
    }
    syncViewerMatches();
  }

  function parseResult(resultStr) {
    const m = resultStr.trim().match(/^(\d+)\s*[-:]\s*(\d+)$/);
    if (!m) return null;
    return { home: parseInt(m[1], 10), away: parseInt(m[2], 10) };
  }

  function recalculateStandings() {
    const stats = {};
    state.players.forEach(p => {
      stats[p.name] = { played: 0, won: 0, drawn: 0, lost: 0, gf: 0, ga: 0, pts: 0 };
    });
    const rows = $('adminMatchesBody').querySelectorAll('tr');
    rows.forEach(row => {
      const cells = row.querySelectorAll('td');
      if (cells.length < 4) return;
      const matchCell = cells[2].textContent || '';
      const resultCell = cells[3].textContent || '';
      if (!matchCell.includes('vs')) return;
      const [homeNameRaw, awayNameRaw] = matchCell.split('vs');
      const homeName = homeNameRaw.trim();
      const awayName = awayNameRaw.replace('(ÙŠØªØ£Ù‡Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)', '').trim();
      const res = parseResult(resultCell);
      if (!res) return;
      if (!stats[homeName] || !stats[awayName]) return;
      const { home, away } = res;
      stats[homeName].played++;
      stats[awayName].played++;
      stats[homeName].gf += home;
      stats[homeName].ga += away;
      stats[awayName].gf += away;
      stats[awayName].ga += home;
      if (home > away) {
        stats[homeName].won++;
        stats[homeName].pts += 3;
        stats[awayName].lost++;
      } else if (home < away) {
        stats[awayName].won++;
        stats[awayName].pts += 3;
        stats[homeName].lost++;
      } else {
        stats[homeName].drawn++;
        stats[awayName].drawn++;
        stats[homeName].pts += 1;
        stats[awayName].pts += 1;
      }
    });
    const body = $('standingsBody');
    body.innerHTML = '';
    const entries = Object.entries(stats).sort((a, b) => b[1].pts - a[1].pts || (b[1].gf - b[1].ga) - (a[1].gf - a[1].ga));
    entries.forEach(([name, s]) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${name}</td>
        <td>${s.played}</td>
        <td>${s.won}</td>
        <td>${s.drawn}</td>
        <td>${s.lost}</td>
        <td>${s.gf}</td>
        <td>${s.ga}</td>
        <td>${s.pts}</td>
      `;
      body.appendChild(tr);
    });
  }

  function init() {
    loadState();
    renderAll();

    $('saveSettings').onclick = () => {
      state.tournamentName = $('tournamentName').value.trim() || state.tournamentName;
      state.format = $('format').value;
      state.duration = $('duration').value.trim();
      state.specialRules = $('specialRules').value
        .split('\n')
        .map(r => r.trim())
        .filter(r => r.length > 0);
      saveState();
      renderAll();
      $('saveStatus').textContent = 'ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…';
      setTimeout(() => $('saveStatus').textContent = '', 2200);
    };

    $('addPlayer').onclick = () => {
      const name = $('playerName').value.trim();
      const note = $('playerNote').value.trim();
      if (!name) return;
      state.players.push({ name, note });
      $('playerName').value = '';
      $('playerNote').value = '';
      saveState();
      renderAll();
    };

    const navButtons = document.querySelectorAll('.nav-pill');
    const pageSections = {
      league: document.getElementById('page-league'),
      admin: document.getElementById('page-admin')
    };

    function showPage(key) {
      if (key === 'admin' && !isAdmin) return;
      Object.keys(pageSections).forEach(k => {
        pageSections[k].classList.toggle('active', k === key);
      });
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    navButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const page = btn.getAttribute('data-page');
        if (page === 'admin' && !isAdmin) return;
        navButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        showPage(page);
      });
    });

    $('generateSchedule').onclick = generateSchedule;
    $('addEmptyMatch').onclick = addEmptyMatchRow;
    $('recalculateStandings').onclick = recalculateStandings;

    $('adminToggle').onclick = () => {
      if (isAdmin) {
        alert('Ø£Ù†Øª Ù…Ø³Ø¬Ù„ ÙƒÙ…Ø¯ÙŠØ± Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù†Ù‡Ø§.');
        return;
      }
      const input = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±:');
      if (input === null) return;
      if (input === ADMIN_PASSWORD) {
        isAdmin = true;
        localStorage.setItem(ADMIN_STATE_KEY, 'true');
        renderMode();
        const adminBtn = $('adminTab');
        document.querySelectorAll('.nav-pill').forEach(b => b.classList.remove('active'));
        adminBtn.classList.add('active');
        showPage('admin');
      } else {
        alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.');
      }
    };

    $('adminLogout').onclick = () => {
      isAdmin = false;
      localStorage.removeItem(ADMIN_STATE_KEY);
      renderMode();
      document.querySelectorAll('.nav-pill').forEach(b => b.classList.remove('active'));
      document.querySelector('[data-page="league"]').classList.add('active');
      showPage('league');
    };
  }

  document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
