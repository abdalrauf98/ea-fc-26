<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>دوري EA FC 26 الرمضاني</title>
  <style>
    :root {
      --bg: #0b1120;
      --surface: #111827;
      --surface-alt: #020617;
      --border: #1f2937;
      --accent: #eab308;
      --text: #f9fafb;
      --muted: #9ca3af;
      --soft: #6b7280;
      --radius: 10px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header {
      background: #020617;
      border-bottom: 1px solid var(--border);
    }

    .shell {
      max-width: 960px;
      margin: 0 auto;
      padding: 12px 14px;
    }

    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .title-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: var(--surface-alt);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .title-text h1 {
      margin: 0;
      font-size: 17px;
      color: var(--accent);
    }

    .title-text p {
      margin: 2px 0 0;
      font-size: 11px;
      color: var(--muted);
    }

    .mode {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 11px;
      color: var(--muted);
    }

    .mode span {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--surface-alt);
    }

    .mode button {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--surface-alt);
      color: var(--text);
      font-size: 11px;
      cursor: pointer;
    }

    nav {
      margin-top: 10px;
      display: flex;
      gap: 6px;
      overflow-x: auto;
    }

    .tab {
      padding: 5px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--surface-alt);
      color: var(--muted);
      font-size: 11px;
      cursor: pointer;
      white-space: nowrap;
    }

    .tab.active {
      border-color: var(--accent);
      color: var(--accent);
      background: #1f2937;
    }

    .tab.disabled {
      opacity: 0.6;
      cursor: default;
    }

    main {
      max-width: 960px;
      margin: 0 auto;
      padding: 14px;
    }

    .card {
      background: var(--surface);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 10px 10px 12px;
      margin-bottom: 10px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .card-header h2 {
      margin: 0;
      font-size: 13px;
    }

    .card-header span {
      font-size: 11px;
      color: var(--soft);
    }

    label {
      display: block;
      font-size: 12px;
      margin-top: 7px;
      margin-bottom: 3px;
    }

    input, select, textarea {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--surface-alt);
      color: var(--text);
      font-size: 12px;
    }

    textarea {
      min-height: 60px;
      resize: vertical;
    }

    button.primary {
      border-radius: 999px;
      padding: 6px 12px;
      border: none;
      background: var(--accent);
      color: #111827;
      font-size: 12px;
      cursor: pointer;
      margin-top: 6px;
    }

    button.secondary {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid var(--border);
      background: var(--surface-alt);
      color: var(--text);
      font-size: 12px;
      cursor: pointer;
      margin-top: 6px;
    }

    button.danger {
      border-radius: 999px;
      padding: 4px 8px;
      border: none;
      background: #b91c1c;
      color: #fef2f2;
      font-size: 11px;
      cursor: pointer;
    }

    .small {
      font-size: 11px;
      color: var(--soft);
      margin-top: 4px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--surface-alt);
      font-size: 11px;
      margin: 2px;
    }

    .pill span.name {
      font-weight: 500;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 11px;
    }

    th, td {
      border: 1px solid #020617;
      padding: 5px 4px;
      text-align: center;
      white-space: nowrap;
    }

    th {
      background: #020617;
      color: var(--muted);
    }

    td {
      background: #0b1120;
    }

    tbody tr:nth-child(even) td {
      background: #020617;
    }

    td[contenteditable="true"] {
      cursor: text;
    }

    td[contenteditable="true"]:focus {
      outline: 1px solid var(--accent);
    }

    .list {
      list-style: none;
      padding: 0;
      margin: 4px 0 0;
    }

    .list li {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 3px;
    }

    .hidden { display: none; }
  </style>
</head>
<body>
  <header>
    <div class="shell">
      <div class="header-row">
        <div class="title-group">
          <div class="logo">⚽</div>
          <div class="title-text">
            <h1 id="title-display">دوري EA FC 26 الرمضاني</h1>
            <p>عرض بسيط للدوري + صفحة إدارة للمنظّم</p>
          </div>
        </div>
        <div class="mode">
          <span id="modeLabel">وضع: مشاهد</span>
          <button id="adminToggle">دخول المدير</button>
        </div>
      </div>
      <nav>
        <button class="tab active" data-page="league">الدوري (للمشاهد)</button>
        <button class="tab" data-page="admin" id="adminTab">الإدارة (للمنظّم)</button>
      </nav>
    </div>
  </header>

  <main>
    <!-- صفحة المشاهد -->
    <section id="page-league">
      <div class="card">
        <div class="card-header">
          <h2>ترتيب الدوري</h2>
          <span>مُحتسب من نتائج المباريات</span>
        </div>
        <table>
          <thead>
            <tr>
              <th>اللاعب</th>
              <th>لعب</th>
              <th>فاز</th>
              <th>تعادل</th>
              <th>خسر</th>
              <th>له</th>
              <th>عليه</th>
              <th>النقاط</th>
            </tr>
          </thead>
          <tbody id="standingsBody"></tbody>
        </table>
        <div class="small">التحديث يتم من صفحة الإدارة.</div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>جدول المباريات</h2>
          <span>يُدار من صفحة الإدارة</span>
        </div>
        <table>
          <thead>
            <tr>
              <th>التاريخ</th>
              <th>الوقت</th>
              <th>المباراة</th>
              <th>النتيجة</th>
            </tr>
          </thead>
          <tbody id="viewerMatchesBody"></tbody>
        </table>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>قوانين الدوري</h2>
        </div>
        <ul class="list" id="rulesDisplay"></ul>
      </div>
    </section>

    <!-- صفحة الإدارة -->
    <section id="page-admin" class="hidden">
      <div class="card">
        <div class="card-header">
          <h2>إعدادات البطولة</h2>
          <span>اسم الدوري ونوع البطولة</span>
        </div>
        <label>اسم الدوري</label>
        <input id="tournamentName" type="text" value="دوري EA FC 26 الرمضاني">
        <label>نوع البطولة</label>
        <select id="format">
          <option value="league">دوري (الجميع ضد الجميع)</option>
          <option value="knockout">كأس – إقصائي مباشر</option>
          <option value="groups-knockout">مجموعات ثم كأس</option>
        </select>
        <label>مدة الدوري (اختياري)</label>
        <input id="duration" type="text" placeholder="مثال: طوال شهر رمضان أو من 10 إلى 20 رمضان">
      </div>

      <div class="card">
        <div class="card-header">
          <h2>اللاعبون</h2>
          <span>إضافة أو حذف اللاعبين</span>
        </div>
        <label>اسم اللاعب / الكنية</label>
        <input id="playerName" type="text" placeholder="مثال: أبو فلان أو PSN ID">
        <label>ملاحظة (اختياري)</label>
        <input id="playerNote" type="text" placeholder="مثال: الفريق المفضل أو أي تعليق بسيط">
        <button id="addPlayer" class="primary">إضافة لاعب</button>
        <div id="playersList" class="small" style="margin-top:6px;"></div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>قوانين الدوري</h2>
          <span>سطر لكل قاعدة</span>
        </div>
        <label>القوانين</label>
        <textarea id="specialRules" placeholder="مثال: مدة الشوط 6 دقائق&#10;مثال: المستوى محترف&#10;مثال: لا يمكن تكرار نفس الفريق في نفس الجولة"></textarea>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>جدول المباريات</h2>
          <span>توليد أو تعديل يدوي</span>
        </div>
        <button id="generateSchedule" class="secondary">توليد جدول حسب نوع البطولة</button>
        <button id="addEmptyMatch" class="secondary">إضافة مباراة يدويًا</button>
        <table>
          <thead>
            <tr>
              <th>التاريخ</th>
              <th>الوقت</th>
              <th>المباراة</th>
              <th>النتيجة</th>
            </tr>
          </thead>
          <tbody id="adminMatchesBody"></tbody>
        </table>
        <div class="small">لن يتم مسح الجدول الحالي عند التوليد إلا بعد تأكيدك. اكتب النتيجة بصيغة 1-3 أو 0-0.</div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>أدوات المنظّم</h2>
        </div>
        <button id="saveSettings" class="primary">حفظ الإعدادات</button>
        <button id="recalculateStandings" class="secondary">تحديث الترتيب من النتائج</button>
        <button id="adminLogout" class="secondary">تسجيل خروج المدير</button>
        <span id="saveStatus" class="small"></span>
      </div>
    </section>
  </main>

  <script>
    const STORAGE_KEY = 'ea_fc_26_tournament';
    const ADMIN_STATE_KEY = 'ea_fc_26_is_admin';
    const ADMIN_PASSWORD = 'Qq112233';

    const state = {
      tournamentName: 'دوري EA FC 26 الرمضاني',
      format: 'league',
      duration: '',
      specialRules: [],
      players: []
    };

    let isAdmin = false;

    function loadState() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) Object.assign(state, JSON.parse(saved));
        isAdmin = localStorage.getItem(ADMIN_STATE_KEY) === 'true';
      } catch (e) {
        console.warn('Failed to load state', e);
      }
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function $(id) { return document.getElementById(id); }

    function formatFormat(f) {
      switch (f) {
        case 'league': return 'دوري (الجميع ضد الجميع)';
        case 'knockout': return 'كأس – إقصائي مباشر';
        case 'groups-knockout': return 'مجموعات ثم كأس';
        default: return 'غير محدد';
      }
    }

    function renderMode() {
      $('modeLabel').textContent = isAdmin ? 'وضع: مدير' : 'وضع: مشاهد';
      $('adminTab').classList.toggle('disabled', !isAdmin);
      $('adminToggle').textContent = isAdmin ? 'دخول المدير مفعل' : 'دخول المدير';
    }

    function syncViewerMatches() {
      const adminBody = $('adminMatchesBody');
      const viewerBody = $('viewerMatchesBody');
      viewerBody.innerHTML = '';
      adminBody.querySelectorAll('tr').forEach(row => {
        const cells = row.querySelectorAll('td');
        if (cells.length < 4) return;
        const tr = document.createElement('tr');
        for (let i = 0; i < 4; i++) {
          const td = document.createElement('td');
          td.textContent = cells[i].textContent;
          tr.appendChild(td);
        }
        viewerBody.appendChild(tr);
      });
    }

    function renderLeagueView() {
      const rulesDisplay = $('rulesDisplay');
      rulesDisplay.innerHTML = '';
      const base = [`نوع البطولة: ${formatFormat(state.format)}`];
      base.concat(state.specialRules.filter(r => r.trim().length > 0)).forEach(rule => {
        const li = document.createElement('li');
        li.textContent = rule;
        rulesDisplay.appendChild(li);
      });

      syncViewerMatches();

      const body = $('standingsBody');
      if (body.childElementCount === 0) {
        state.players.forEach(p => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${p.name}</td>
            <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
          `;
          body.appendChild(tr);
        });
      }
    }

    function renderAdminView() {
      $('tournamentName').value = state.tournamentName;
      $('format').value = state.format;
      $('duration').value = state.duration;
      $('specialRules').value = state.specialRules.join('\n');

      const list = $('playersList');
      list.innerHTML = '';
      state.players.forEach((p, idx) => {
        const pill = document.createElement('span');
        pill.className = 'pill';
        pill.innerHTML = `<span class="name">${p.name}</span><span>${p.note || ''}</span>`;
        const btn = document.createElement('button');
        btn.className = 'danger';
        btn.textContent = 'حذف';
        btn.onclick = () => {
          state.players.splice(idx, 1);
          saveState();
          renderAll();
        };
        pill.appendChild(btn);
        list.appendChild(pill);
      });
    }

    function renderAll() {
      $('title-display').textContent = state.tournamentName || 'دوري EA FC 26 الرمضاني';
      renderMode();
      renderAdminView();
      renderLeagueView();
    }

    function addEmptyMatchRow() {
      const tbody = $('adminMatchesBody');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td contenteditable="true">-</td>
        <td contenteditable="true">-</td>
        <td contenteditable="true">لاعب A vs لاعب B</td>
        <td contenteditable="true">-</td>
      `;
      tbody.appendChild(tr);
      syncViewerMatches();
    }

    function generateLeagueSchedule(tbody, players) {
      players.forEach((home, i) => {
        for (let j = i + 1; j < players.length; j++) {
          const away = players[j];
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td contenteditable="true">-</td>
            <td contenteditable="true">-</td>
            <td contenteditable="true">${home} vs ${away}</td>
            <td contenteditable="true">-</td>
          `;
          tbody.appendChild(tr);
        }
      });
    }

    function generateKnockoutSchedule(tbody, players) {
      for (let i = 0; i < players.length; i += 2) {
        const p1 = players[i];
        const p2 = players[i + 1];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td contenteditable="true">-</td>
          <td contenteditable="true">-</td>
          <td contenteditable="true">${p1}${p2 ? ' vs ' + p2 : ' (يتأهل تلقائياً)'} </td>
          <td contenteditable="true">-</td>
        `;
        tbody.appendChild(tr);
      }
    }

    function generateSchedule() {
      const tbody = $('adminMatchesBody');
      const players = state.players.map(p => p.name).filter(Boolean);
      if (players.length < 2) {
        alert('يجب إضافة لاعبين على الأقل لتوليد جدول المباريات.');
        return;
      }
      if (tbody.childElementCount > 0) {
        const confirmClear = confirm('سيتم مسح جدول المباريات الحالي واستبداله بجديد. هل تريد المتابعة؟');
        if (!confirmClear) return;
        tbody.innerHTML = '';
      }
      if (state.format === 'league') {
        generateLeagueSchedule(tbody, players);
      } else if (state.format === 'knockout') {
        generateKnockoutSchedule(tbody, players);
      } else {
        generateLeagueSchedule(tbody, players);
      }
      syncViewerMatches();
    }

    function parseResult(str) {
      const m = str.trim().match(/^(\d+)\s*[-:]\s*(\d+)$/);
      if (!m) return null;
      return { home: parseInt(m[1], 10), away: parseInt(m[2], 10) };
    }

    function recalculateStandings() {
      const stats = {};
      state.players.forEach(p => {
        stats[p.name] = { played: 0, won: 0, drawn: 0, lost: 0, gf: 0, ga: 0, pts: 0 };
      });
      const rows = $('adminMatchesBody').querySelectorAll('tr');
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if (cells.length < 4) return;
        const matchCell = cells[2].textContent || '';
        const resultCell = cells[3].textContent || '';
        if (!matchCell.includes('vs')) return;
        const [homeRaw, awayRaw] = matchCell.split('vs');
        const homeName = homeRaw.trim();
        const awayName = awayRaw.replace('(يتأهل تلقائياً)', '').trim();
        const res = parseResult(resultCell);
        if (!res) return;
        if (!stats[homeName] || !stats[awayName]) return;
        const { home, away } = res;
        stats[homeName].played++;
        stats[awayName].played++;
        stats[homeName].gf += home;
        stats[homeName].ga += away;
        stats[awayName].gf += away;
        stats[awayName].ga += home;
        if (home > away) {
          stats[homeName].won++;
          stats[homeName].pts += 3;
          stats[awayName].lost++;
        } else if (home < away) {
          stats[awayName].won++;
          stats[awayName].pts += 3;
          stats[homeName].lost++;
        } else {
          stats[homeName].drawn++;
          stats[awayName].drawn++;
          stats[homeName].pts += 1;
          stats[awayName].pts += 1;
        }
      });
      const body = $('standingsBody');
      body.innerHTML = '';
      const entries = Object.entries(stats).sort((a, b) => b[1].pts - a[1].pts || (b[1].gf - b[1].ga) - (a[1].gf - a[1].ga));
      entries.forEach(([name, s]) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${name}</td>
          <td>${s.played}</td>
          <td>${s.won}</td>
          <td>${s.drawn}</td>
          <td>${s.lost}</td>
          <td>${s.gf}</td>
          <td>${s.ga}</td>
          <td>${s.pts}</td>
        `;
        body.appendChild(tr);
      });
    }

    function init() {
      loadState();
      renderAll();

      $('saveSettings').onclick = () => {
        state.tournamentName = $('tournamentName').value.trim() || state.tournamentName;
        state.format = $('format').value;
        state.duration = $('duration').value.trim();
        state.specialRules = $('specialRules').value.split('\n').map(r => r.trim()).filter(Boolean);
        saveState();
        renderAll();
        $('saveStatus').textContent = 'تم الحفظ ✅';
        setTimeout(() => $('saveStatus').textContent = '', 2000);
      };

      $('addPlayer').onclick = () => {
        const name = $('playerName').value.trim();
        const note = $('playerNote').value.trim();
        if (!name) return;
        state.players.push({ name, note });
        $('playerName').value = '';
        $('playerNote').value = '';
        saveState();
        renderAll();
      };

      document.querySelectorAll('.tab').forEach(btn => {
        btn.onclick = () => {
          const page = btn.getAttribute('data-page');
          if (page === 'admin' && !isAdmin) return;
          document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          $('page-league').classList.toggle('hidden', page !== 'league');
          $('page-admin').classList.toggle('hidden', page !== 'admin');
        };
      });

      $('generateSchedule').onclick = generateSchedule;
      $('addEmptyMatch').onclick = addEmptyMatchRow;
      $('recalculateStandings').onclick = recalculateStandings;

      $('adminToggle').onclick = () => {
        if (isAdmin) {
          alert('أنت مسجل كمدير حالياً. يمكنك استخدام صفحة الإدارة أو تسجيل الخروج.');
          return;
        }
        const input = prompt('أدخل كلمة مرور المدير:');
        if (input === null) return;
        if (input === ADMIN_PASSWORD) {
          isAdmin = true;
          localStorage.setItem(ADMIN_STATE_KEY, 'true');
          renderMode();
          document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
          $('adminTab').classList.add('active');
          $('page-league').classList.add('hidden');
          $('page-admin').classList.remove('hidden');
        } else {
          alert('كلمة المرور غير صحيحة.');
        }
      };

      $('adminLogout').onclick = () => {
        isAdmin = false;
        localStorage.removeItem(ADMIN_STATE_KEY);
        renderMode();
        document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
        document.querySelector('.tab[data-page="league"]').classList.add('active');
        $('page-league').classList.remove('hidden');
        $('page-admin').classList.add('hidden');
      };
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
